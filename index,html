<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Live Bet Tracker</title>
    <style>
        :root {
            --espn-red: #cc0000;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
        }
        /* Sidebar Styles */
        #sidebar {
            width: 350px;
            background-color: var(--card-bg);
            padding: 20px;
            border-right: 2px solid #333;
            overflow-y: auto;
        }
        /* Main Stats Display */
        #live-stats {
            flex-grow: 1;
            padding: 40px;
            overflow-y: auto;
        }
        .bet-card {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 5px solid var(--espn-red);
        }
        .stat-update {
            font-size: 1.2em;
            font-weight: bold;
            color: #4caf50;
        }
        select, input, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            border: none;
            background: #333;
            color: white;
        }
        button {
            background-color: var(--espn-red);
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background-color: #ff0000; }
        .refresh-tag { font-size: 0.8em; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>Add New Bet</h2>
    
    <label>Live/Upcoming Game:</label>
    <select id="game-select" onchange="loadPlayers()">
        <option>Loading live games...</option>
    </select>

    <label>Player:</label>
    <select id="player-select">
        <option>Select a game first</option>
    </select>

    <label>Bet Category:</label>
    <select id="stat-category">
        <option value="rushingYards">Rushing Yards</option>
        <option value="passingYards">Passing Yards</option>
        <option value="receivingYards">Receiving Yards</option>
        <option value="receptions">Receptions</option>
    </select>

    <label>Line (Over/Under Value):</label>
    <input type="number" id="bet-line" placeholder="e.g. 75.5">

    <button onclick="addBet()">Add to Tracker</button>
    
    <div class="refresh-tag" id="last-update">Last update: Never</div>
</div>

<div id="live-stats">
    <h1>My Active Bets</h1>
    <div id="bets-container">
        </div>
</div>

<script>
    let myBets = [];
    const ESPN_API = "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard";

    // 1. Fetch Live Games for Dropdown
    async function fetchLiveGames() {
        const response = await fetch(ESPN_API);
        const data = await response.json();
        const select = document.getElementById('game-select');
        select.innerHTML = '<option value="">-- Choose a Game --</option>';

        data.events.forEach(event => {
            const option = document.createElement('option');
            option.value = event.id;
            option.textContent = event.name;
            select.appendChild(option);
        });
    }

    // 2. Fetch Players for Selected Game
    async function loadPlayers() {
        const gameId = document.getElementById('game-select').value;
        if (!gameId) return;

        const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/summary?event=${gameId}`);
        const data = await response.json();
        const playerSelect = document.getElementById('player-select');
        playerSelect.innerHTML = '';

        // Flatten athletes from both teams
        data.competitors.forEach(team => {
            team.roster.forEach(player => {
                const opt = document.createElement('option');
                opt.value = player.athlete.id;
                opt.textContent = `${player.athlete.displayName} (${team.team.abbreviation})`;
                playerSelect.appendChild(opt);
            });
        });
    }

    // 3. Add Bet to Local List
    function addBet() {
        const bet = {
            gameId: document.getElementById('game-select').value,
            playerId: document.getElementById('player-select').value,
            playerName: document.getElementById('player-select').options[document.getElementById('player-select').selectedIndex].text,
            category: document.getElementById('stat-category').value,
            line: document.getElementById('bet-line').value,
            currentStat: 0
        };
        myBets.push(bet);
        updateUI();
    }

    // 4. Update Live Stats every 30 seconds
    async function refreshStats() {
        for (let bet of myBets) {
            const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/summary?event=${bet.gameId}`);
            const data = await response.json();
            
            // Search data.boxscore.players for the specific player and stat
            data.boxscore.players.forEach(teamStats => {
                teamStats.statistics.forEach(statGroup => {
                    const athleteStat = statGroup.athletes.find(a => a.athlete.id === bet.playerId);
                    if (athleteStat) {
                        const statIndex = statGroup.labels.indexOf(getESPNLabel(bet.category));
                        if (statIndex !== -1) {
                            bet.currentStat = athleteStat.stats[statIndex];
                        }
                    }
                });
            });
        }
        updateUI();
        document.getElementById('last-update').textContent = "Last update: " + new Date().toLocaleTimeString();
    }

    function getESPNLabel(cat) {
        const map = { "rushingYards": "YDS", "passingYards": "YDS", "receivingYards": "YDS", "receptions": "REC" };
        return map[cat];
    }

    function updateUI() {
        const container = document.getElementById('bets-container');
        container.innerHTML = '';
        myBets.forEach(bet => {
            const diff = bet.currentStat - bet.line;
            const statusColor = diff >= 0 ? "#4caf50" : "#ff9800";
            
            container.innerHTML += `
                <div class="bet-card">
                    <h3>${bet.playerName}</h3>
                    <p>Bet: ${bet.line} ${bet.category}</p>
                    <div class="stat-update" style="color:${statusColor}">Live: ${bet.currentStat}</div>
                    <small>${diff >= 0 ? 'OVER by ' + diff.toFixed(1) : 'UNDER by ' + Math.abs(diff).toFixed(1)}</small>
                </div>
            `;
        });
    }

    // Initialize
    fetchLiveGames();
    setInterval(refreshStats, 30000); // 30 second refresh
</script>

</body>
</html>
